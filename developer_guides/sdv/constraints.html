
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Constraints &#8212; SDV 0.4.1 documentation</title>
    
  <link rel="stylesheet" href="../../_static/css/index.d431a4ee1c1efae0e38bdfebc22debff.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.30270b6e4c972e43c488.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../_static/SDV-Logo-Black.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Metadata Schema" href="metadata.html" />
    <link rel="prev" title="Tabular Models" href="tabular.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../../index.html">
      <img src="../../_static/SDV-Logo-Color.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../getting_started/index.html">Getting Started</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../user_guides/index.html">User Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../api_reference/index.html">API Reference</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../index.html">Developer Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../history.html">Release Notes</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/sdv-dev/SDV" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
        
          

              <li class="active">
                  <a href="../overview.html">The Synthetic Data Vault</a>
                  <ul>
                  
                      <li class="active">
                          <a href="index.html">SDV</a>
                      </li>
                  
                  </ul>
              </li>
          
        
          
              <li class="">
                  <a href="../contributing.html">Contributing to SDV</a>
              </li>
          
        
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#base-constraint" class="nav-link">Base Constraint</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#handling-strategy" class="nav-link">handling_strategy</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#implementing-a-custom-constraint" class="nav-link">Implementing a Custom Constraint</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="constraints">
<h1>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h1>
<p>The Constraints are implemented in the subpackage <a class="reference internal" href="../../api_reference/constraints.html#sdv-constraints"><span class="std std-ref">sdv.constraints</span></a>.</p>
<div class="section" id="base-constraint">
<h2>Base Constraint<a class="headerlink" href="#base-constraint" title="Permalink to this headline">¶</a></h2>
<p>All the Constraints in SDV inherit from the <code class="docutils literal notranslate"><span class="pre">sdv.constraint.base.Constraint</span></code> class.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Constraint</span></code> defines the public API for all its subclasses. The public API is implemented
in some cases using no-op (methods that do nothing) or identity (methods that return what they
are given) methods, so subclasses can overwrite only what they need but still have a complete
API which is compatible with the rest of the project.</p>
<p>The following public methods are implemented in this class:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code>: No-op method.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transform</span></code>: Identity method.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit_transform</span></code>: Call <code class="docutils literal notranslate"><span class="pre">self.fit</span></code> and then call <code class="docutils literal notranslate"><span class="pre">self.transform</span></code> and return its outputs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reverse_transform</span></code>: Identity method.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_valid</span></code>: Return a <code class="docutils literal notranslate"><span class="pre">pandas.Series</span></code> full or <code class="docutils literal notranslate"><span class="pre">True</span></code> values with the same length as the
given data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filter_valid</span></code>: Return only the rows for which <code class="docutils literal notranslate"><span class="pre">self.is_valid</span></code> returns <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_dict</span></code>: Build a <code class="docutils literal notranslate"><span class="pre">Constraint</span></code> from its dict representation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">to_dict</span></code>: Return a dict representing the <code class="docutils literal notranslate"><span class="pre">Constraint</span></code>.</p></li>
</ul>
<div class="section" id="handling-strategy">
<h3>handling_strategy<a class="headerlink" href="#handling-strategy" title="Permalink to this headline">¶</a></h3>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">Constraint.__init__</span></code> method sets up the class based on the value of the
argument <code class="docutils literal notranslate"><span class="pre">handling_strategy</span></code> as follows:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">handling_strategy</span></code> equals <code class="docutils literal notranslate"><span class="pre">'transform'</span></code>, the <code class="docutils literal notranslate"><span class="pre">filter_valid</span></code> method is disabled by
replacing it with an identity function.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">handling_strategy</span></code> equals <code class="docutils literal notranslate"><span class="pre">'reject_sampling'</span></code>, both the <code class="docutils literal notranslate"><span class="pre">transform</span></code> and
<code class="docutils literal notranslate"><span class="pre">reverse_transform</span></code> methods are disabled by replacing them with an identity function.</p></li>
</ul>
<p>Because of this, any subclass has the option to implement both the transformation and reject
sampling strategies and later on give the user the choice to choose between the two by just
calling the <code class="docutils literal notranslate"><span class="pre">super().__init__</span></code> method passing the corresponding <code class="docutils literal notranslate"><span class="pre">handling_strategy</span></code> value.</p>
</div>
</div>
<div class="section" id="implementing-a-custom-constraint">
<h2>Implementing a Custom Constraint<a class="headerlink" href="#implementing-a-custom-constraint" title="Permalink to this headline">¶</a></h2>
<p>In order to implement a custom constraint, all you need to do is create a subclass of
<code class="docutils literal notranslate"><span class="pre">Constraint</span></code> and implement your own <code class="docutils literal notranslate"><span class="pre">fit</span></code>, <code class="docutils literal notranslate"><span class="pre">transform</span></code>, <code class="docutils literal notranslate"><span class="pre">reverse_transform</span></code> and
<code class="docutils literal notranslate"><span class="pre">is_valid</span></code> methods.</p>
<p>Let us think, for example, of the following scenario: Suppose we have a dataset about invertebrate
and that there is a column that indicates their number of legs. Insects, which are one of the most
common invertebrae, always have 6 legs, but there are other families which have none, or just 2,
and some even extend to hundreds of legs. But this value has the following properties:</p>
<ul class="simple">
<li><p>It is always positive.</p></li>
<li><p>It is always an even number.</p></li>
</ul>
<p>Expecting our tabular models to learn such properties on their own is very hard, especially
regarding the even numbers, so we will try to help the models by defining a custom Constraint
called <code class="docutils literal notranslate"><span class="pre">PositiveEvenInteger</span></code>, which inherits from <code class="docutils literal notranslate"><span class="pre">Constraint</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PositiveEvenInteger</span><span class="p">(</span><span class="n">Constraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensure that values are positive and even.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</pre></div>
</div>
<p>The simplest way to ensure that the values have the desired properties is to validate them,
so let’s define the <code class="docutils literal notranslate"><span class="pre">is_valid</span></code> method accordingly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PositiveEven</span><span class="p">(</span><span class="n">Constraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensure that values are positive and even.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span> <span class="o">=</span> <span class="n">column_name</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Say if values are positive and even.&quot;&quot;&quot;</span>
        <span class="n">column_data</span> <span class="o">=</span> <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="n">column_data</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">even</span> <span class="o">=</span> <span class="n">column_data</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">positive</span> <span class="o">&amp;</span> <span class="n">even</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice how we also had to add a <code class="docutils literal notranslate"><span class="pre">column_name</span></code> argument to our <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method,
so we know which column we need to validate.</p>
</div>
<p>With the current implementation modeling would happen as usual. However, during sampling,
all the rows would be validated using the <code class="docutils literal notranslate"><span class="pre">is_valid</span></code> method that we implemented, and invalid
rows would be rejected and resampled until the number of desired rows has been generated.</p>
<p>In this case this might be acceptable because each row only has a 50% chance of being invalid,
which means that, on average, we would need the model to sample only 2 times the number of rows
that we need in order to get enough valid rows. However, in some other cases this can take a long
time, especially if the condition imposed has a very low chance of being true. In such cases, we
might want to use a transformation strategy where the data is transformed before modeling into
something that the model can learn more easily, and then reverted after sampling back into the
original format.</p>
<p>For our dataset, a possibility would be to divide the number of legs by two, so we end up
modeling and sampling the number of <cite>pairs of legs</cite> instead of the number of <cite>legs</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PositiveEven</span><span class="p">(</span><span class="n">Constraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensure that values are positive and even.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span> <span class="o">=</span> <span class="n">column_name</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Say if values are positive and even.&quot;&quot;&quot;</span>
        <span class="n">column_data</span> <span class="o">=</span> <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="n">column_data</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">even</span> <span class="o">=</span> <span class="n">column_data</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">positive</span> <span class="o">&amp;</span> <span class="n">even</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divide the data by two before modeling.&quot;&quot;&quot;</span>
        <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">table_data</span>

    <span class="k">def</span> <span class="nf">reverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply the data by two after sampling.&quot;&quot;&quot;</span>
        <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">table_data</span>
</pre></div>
</div>
<p>With this new implementation, our Constraint would be ready to handle both strategies,
<cite>reject sampling</cite> and <cite>transform</cite>, but in some cases we might want to let the user
chose only one of them, so the other is skipped.</p>
<p>In a situation like this, we can simply add a <code class="docutils literal notranslate"><span class="pre">handling_strategy</span></code> parameter to our
<code class="docutils literal notranslate"><span class="pre">__init__</span></code> method and call <code class="docutils literal notranslate"><span class="pre">super().__init__</span></code> passing it, so the base <code class="docutils literal notranslate"><span class="pre">Constraint</span></code> class
can handle it adequately:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PositiveEven</span><span class="p">(</span><span class="n">Constraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensure that values are positive and even.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">handling_strategy</span><span class="o">=</span><span class="s1">&#39;transform&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span> <span class="o">=</span> <span class="n">column_name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handling_strategy</span><span class="o">=</span><span class="n">handling_strategy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Say if values are positive and even.&quot;&quot;&quot;</span>
        <span class="n">column_data</span> <span class="o">=</span> <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="n">column_data</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">even</span> <span class="o">=</span> <span class="n">column_data</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">positive</span> <span class="o">&amp;</span> <span class="n">even</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divide the data by two before modeling.&quot;&quot;&quot;</span>
        <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">table_data</span>

    <span class="k">def</span> <span class="nf">reverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply the data by two after sampling.&quot;&quot;&quot;</span>
        <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">table_data</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="tabular.html" title="previous page">Tabular Models</a>
    <a class='right-next' id="next-link" href="metadata.html" title="next page">Metadata Schema</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../_static/js/index.30270b6e4c972e43c488.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018, MIT Data To AI Lab.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>