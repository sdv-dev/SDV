
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CopulaGAN Model &#8212; SDV 0.4.4 documentation</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../_static/SDV-Logo-Black.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Handling Constraints" href="constraints.html" />
    <link rel="prev" title="CTGAN Model" href="ctgan.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../../index.html">
    
      <img src="../../_static/SDV-Logo-Color.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../getting_started/index.html">Getting Started</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../index.html">User Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../api_reference/index.html">API Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../developer_guides/index.html">Developer Guides</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../history.html">Release Notes</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/sdv-dev/SDV" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/sdv_dev" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
          
            
  
                <li class="active">
                    <a href="index.html">Single Table Data</a>
                    <ul>
                    
                        <li class="">
                            <a href="data_description.html">Data Description</a>
                        </li>
                    
                        <li class="active">
                            <a href="models.html">Models</a>
                        </li>
                    
                        <li class="">
                            <a href="constraints.html">Handling Constraints</a>
                        </li>
                    
                        <li class="">
                            <a href="evaluation.html">Evaluating Synthetic Data</a>
                        </li>
                    
                    </ul>
                </li>
            
          
            
                <li class="">
                    <a href="../relational/index.html">Relational Data</a>
                </li>
            
          
            
                <li class="">
                    <a href="../timeseries/index.html">Timeseries Data</a>
                </li>
            
          
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#what-is-copulagan" class="nav-link">What is CopulaGAN?</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#quick-usage" class="nav-link">Quick Usage</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#generate-synthetic-data-from-the-model" class="nav-link">Generate synthetic data from the model</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#save-and-load-the-model" class="nav-link">Save and Load the model</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#save-and-share-the-model" class="nav-link">Save and share the model</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#load-the-model-and-generate-new-data" class="nav-link">Load the model and generate new data</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#specifying-the-primary-key-of-the-table" class="nav-link">Specifying the Primary Key of the table</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#anonymizing-personally-identifiable-information-pii" class="nav-link">Anonymizing Personally Identifiable Information (PII)</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#advanced-usage" class="nav-link">Advanced Usage</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#exploring-the-probability-distributions" class="nav-link">Exploring the Probability Distributions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#setting-distributions-for-indvidual-variables" class="nav-link">Setting distributions for indvidual variables</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#how-to-modify-the-copulagan-hyperparameters" class="nav-link">How to modify the CopulaGAN Hyperparameters?</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#how-do-i-specify-constraints" class="nav-link">How do I specify constraints?</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#can-i-evaluate-the-synthetic-data" class="nav-link">Can I evaluate the Synthetic Data?</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="copulagan-model">
<span id="copulagan"></span><h1>CopulaGAN Model<a class="headerlink" href="#copulagan-model" title="Permalink to this headline">¶</a></h1>
<p>In this guide we will go through a series of steps that will let you
discover functionalities of the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> model, including how to:</p>
<ul class="simple">
<li><p>Create an instance of <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code>.</p></li>
<li><p>Fit the instance to your data.</p></li>
<li><p>Generate synthetic versions of your data.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> to anonymize PII information.</p></li>
<li><p>Customize the data transformations to improve the learning process.</p></li>
<li><p>Specify the column distributions to improve the output quality.</p></li>
<li><p>Specify hyperparameters to improve the output quality.</p></li>
</ul>
<div class="section" id="what-is-copulagan">
<h2>What is CopulaGAN?<a class="headerlink" href="#what-is-copulagan" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sdv.tabular.CopulaGAN</span></code> model is a variation of the <a class="reference internal" href="ctgan.html#ctgan"><span class="std std-ref">CTGAN Model</span></a>
which takes advantage of the CDF based transformation that the GaussianCopulas
apply to make the underlying CTGAN model task of learning the data easier.</p>
<p>Let’s now discover how to learn a dataset and later on generate
synthetic data with the same format and statistical properties by using
the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> class from SDV.</p>
</div>
<div class="section" id="quick-usage">
<h2>Quick Usage<a class="headerlink" href="#quick-usage" title="Permalink to this headline">¶</a></h2>
<p>We will start by loading one of our demo datasets, the
<code class="docutils literal notranslate"><span class="pre">student_placements</span></code>, which contains information about MBA students
that applied for placements during the year 2020.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In order to follow this guide you need to have <code class="docutils literal notranslate"><span class="pre">ctgan</span></code> installed on
your system. If you have not done it yet, please install <code class="docutils literal notranslate"><span class="pre">ctgan</span></code> now
by executing the command <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">sdv[ctgan]</span></code> in a terminal.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">sdv.demo</span> <span class="kn">import</span> <span class="n">load_tabular_demo</span>

<span class="gp">In [2]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">load_tabular_demo</span><span class="p">(</span><span class="s1">&#39;student_placements&#39;</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="gh">Out[3]: </span><span class="go"></span>
<span class="go">                                      0                    1                    2         3                    4</span>
<span class="go">student_id                        17264                17265                17266     17267                17268</span>
<span class="go">gender                                M                    M                    M         M                    M</span>
<span class="go">second_perc                          67                79.33                   65        56                 85.8</span>
<span class="go">high_perc                            91                78.33                   68        52                 73.6</span>
<span class="go">high_spec                      Commerce              Science                 Arts   Science             Commerce</span>
<span class="go">degree_perc                          58                77.48                   64        52                 73.3</span>
<span class="go">degree_type                    Sci&amp;Tech             Sci&amp;Tech            Comm&amp;Mgmt  Sci&amp;Tech            Comm&amp;Mgmt</span>
<span class="go">work_experience                   False                 True                False     False                False</span>
<span class="go">experience_years                      0                    1                    0         0                    0</span>
<span class="go">employability_perc                   55                 86.5                   75        66                 96.8</span>
<span class="go">mba_spec                         Mkt&amp;HR              Mkt&amp;Fin              Mkt&amp;Fin    Mkt&amp;HR              Mkt&amp;Fin</span>
<span class="go">mba_perc                           58.8                66.28                 57.8     59.43                 55.5</span>
<span class="go">salary                            27000                20000                25000       NaN                42500</span>
<span class="go">placed                             True                 True                 True     False                 True</span>
<span class="go">start_date          2020-07-23 00:00:00  2020-01-11 00:00:00  2020-01-26 00:00:00       NaT  2020-07-04 00:00:00</span>
<span class="go">end_date            2020-10-12 00:00:00  2020-04-09 00:00:00  2020-07-13 00:00:00       NaT  2020-09-27 00:00:00</span>
<span class="go">duration                            3.0                  3.0                  6.0       NaN                  3.0</span>
</pre></div>
</div>
<p>As you can see, this table contains information about students which
includes, among other things:</p>
<ul class="simple">
<li><p>Their id and gender</p></li>
<li><p>Their grades and specializations</p></li>
<li><p>Their work experience</p></li>
<li><p>The salary that they where offered</p></li>
<li><p>The duration and dates of their placement</p></li>
</ul>
<p>You will notice that there is data with the following characteristics:</p>
<ul class="simple">
<li><p>There are float, integer, boolean, categorical and datetime values.</p></li>
<li><p>There are some variables that have missing data. In particular, all
the data related to the placement details is missing in the rows
where the student was not placed.</p></li>
</ul>
<p>Let us use <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> to learn this data and then sample synthetic data
about new students to see how well de model captures the characteristics
indicated above. In order to do this you will need to:</p>
<ul class="simple">
<li><p>Import the <code class="docutils literal notranslate"><span class="pre">sdv.tabular.CopulaGAN</span></code> class and create an instance of it.</p></li>
<li><p>Call its <code class="docutils literal notranslate"><span class="pre">fit</span></code> method passing our table.</p></li>
<li><p>Call its <code class="docutils literal notranslate"><span class="pre">sample</span></code> method indicating the number of synthetic rows
that you want to generate.</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="kn">from</span> <span class="nn">sdv.tabular</span> <span class="kn">import</span> <span class="n">CopulaGAN</span>

<span class="gp">In [5]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CopulaGAN</span><span class="p">()</span>

<span class="gp">In [6]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that the model <code class="docutils literal notranslate"><span class="pre">fitting</span></code> process took care of transforming the
different fields using the appropriate <a class="reference external" href="http://github.com/sdv-dev/RDT">Reversible Data
Transforms</a> to ensure that the data
has a format that the underlying CTGANSynthesizer class can handle.</p>
</div>
<div class="section" id="generate-synthetic-data-from-the-model">
<h3>Generate synthetic data from the model<a class="headerlink" href="#generate-synthetic-data-from-the-model" title="Permalink to this headline">¶</a></h3>
<p>Once the modeling has finished you are ready to generate new synthetic
data by calling the <code class="docutils literal notranslate"><span class="pre">sample</span></code> method from your model passing the number
of rows that we want to generate.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p>This will return a table identical to the one which the model was fitted
on, but filled with new data which resembles the original one.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[8]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc   high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec   mba_perc        salary  placed                    start_date                      end_date duration</span>
<span class="go">0       17339      M    66.552520   69.047810  Commerce    79.953524   Comm&amp;Mgmt            False                 0           58.364346  Mkt&amp;Fin  61.646812           NaN    True 2020-01-24 08:21:37.693389824 2020-08-07 19:51:50.744283136      NaN</span>
<span class="go">1       17281      M    70.700910   58.717499   Science    70.898115    Sci&amp;Tech            False                 0           83.725507  Mkt&amp;Fin  49.553664           NaN    True 2020-11-08 16:09:58.385582848                           NaT      3.0</span>
<span class="go">2       17280      M    87.427437   62.364408  Commerce    67.820768      Others            False                 0           96.894495   Mkt&amp;HR  72.696401  27464.247924    True 2020-03-09 20:24:39.474843648 2020-09-10 06:56:07.881372928      NaN</span>
<span class="go">3       17265      F    82.634266   74.950878  Commerce    81.256936   Comm&amp;Mgmt            False                 0           59.624996   Mkt&amp;HR  65.471931  30709.484435   False 2020-03-31 05:43:52.213367040 2020-08-23 20:27:30.296123392     12.0</span>
<span class="go">4       17452      M    47.631543  101.841097   Science    69.208190   Comm&amp;Mgmt            False                 0           73.535638  Mkt&amp;Fin  79.044774  31335.779352    True 2020-02-26 23:12:11.761102592                           NaT      6.0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can control the number of rows by specifying the number of
<code class="docutils literal notranslate"><span class="pre">samples</span></code> in the <code class="docutils literal notranslate"><span class="pre">model.sample(&lt;num_rows&gt;)</span></code>. To test, try
<code class="docutils literal notranslate"><span class="pre">model.sample(10000)</span></code>. Note that the original table only had ~200
rows.</p>
</div>
</div>
<div class="section" id="save-and-load-the-model">
<h3>Save and Load the model<a class="headerlink" href="#save-and-load-the-model" title="Permalink to this headline">¶</a></h3>
<p>In many scenarios it will be convenient to generate synthetic versions
of your data directly in systems that do not have access to the original
data source. For example, if you may want to generate testing data on
the fly inside a testing environment that does not have access to your
production database. In these scenarios, fitting the model with real
data every time that you need to generate new data is feasible, so you
will need to fit a model in your production environment, save the fitted
model into a file, send this file to the testing environment and then
load it there to be able to <code class="docutils literal notranslate"><span class="pre">sample</span></code> from it.</p>
<p>Let’s see how this process works.</p>
<div class="section" id="save-and-share-the-model">
<h4>Save and share the model<a class="headerlink" href="#save-and-share-the-model" title="Permalink to this headline">¶</a></h4>
<p>Once you have fitted the model, all you need to do is call its <code class="docutils literal notranslate"><span class="pre">save</span></code>
method passing the name of the file in which you want to save the model.
Note that the extension of the filename is not relevant, but we will be
using the <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> extension to highlight that the serialization
protocol used is
<a class="reference external" href="https://docs.python.org/3/library/pickle.html">pickle</a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;my_model.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will have created a file called <code class="docutils literal notranslate"><span class="pre">my_model.pkl</span></code> in the same
directory in which you are running SDV.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you inspect the generated file you will notice that its size is much
smaller than the size of the data that you used to generate it. This is
because the serialized model contains <strong>no information about the
original data</strong>, other than the parameters it needs to generate
synthetic versions of it. This means that you can safely share this
<code class="docutils literal notranslate"><span class="pre">my_model.pkl</span></code> file without the risc of disclosing any of your real
data!</p>
</div>
</div>
<div class="section" id="load-the-model-and-generate-new-data">
<h4>Load the model and generate new data<a class="headerlink" href="#load-the-model-and-generate-new-data" title="Permalink to this headline">¶</a></h4>
<p>The file you just generated can be send over to the system where the
synthetic data will be generated. Once it is there, you can load it
using the <code class="docutils literal notranslate"><span class="pre">CopulaGAN.load</span></code> method, and then you are ready to sample new
data from the loaded instance:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">loaded</span> <span class="o">=</span> <span class="n">CopulaGAN</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;my_model.pkl&#39;</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">loaded</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Notice that the system where the model is loaded needs to also have
<code class="docutils literal notranslate"><span class="pre">sdv</span></code> and <code class="docutils literal notranslate"><span class="pre">ctgan</span></code> installed, otherwise it will not be able to load
the model and use it.</p>
</div>
</div>
</div>
<div class="section" id="specifying-the-primary-key-of-the-table">
<h3>Specifying the Primary Key of the table<a class="headerlink" href="#specifying-the-primary-key-of-the-table" title="Permalink to this headline">¶</a></h3>
<p>One of the first things that you may have noticed when looking that demo
data is that there is a <code class="docutils literal notranslate"><span class="pre">student_id</span></code> column which acts as the primary
key of the table, and which is supposed to have unique values. Indeed,
if we look at the number of times that each value appears, we see that
all of them appear at most once:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">data</span><span class="o">.</span><span class="n">student_id</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gh">Out[12]: </span><span class="go">1</span>
</pre></div>
</div>
<p>However, if we look at the synthetic data that we generated, we observe
that there are some values that appear more than once:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">student_id</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gh">Out[13]: </span><span class="go">9</span>

<span class="gp">In [14]: </span><span class="n">new_data</span><span class="p">[</span><span class="n">new_data</span><span class="o">.</span><span class="n">student_id</span> <span class="o">==</span> <span class="n">new_data</span><span class="o">.</span><span class="n">student_id</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gh">Out[14]: </span><span class="go"></span>
<span class="go">     student_id gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec   mba_perc        salary  placed                    start_date                      end_date duration</span>
<span class="go">56        17264      M    48.477395  67.002635  Commerce    77.721419    Sci&amp;Tech            False                 1           85.881389   Mkt&amp;HR  51.316343  30465.441338    True 2020-05-08 20:14:06.444091392 2020-08-20 13:15:07.035501568      6.0</span>
<span class="go">58        17264      M    88.598805  89.842762   Science    60.143301    Sci&amp;Tech             True                 0           73.727964   Mkt&amp;HR  61.532543  36982.362418   False 2020-02-18 09:19:09.142702592                           NaT      NaN</span>
<span class="go">64        17264      M    85.889955  64.466116   Science    71.801559   Comm&amp;Mgmt            False                 0           96.774336  Mkt&amp;Fin  50.761723           NaN    True 2020-06-05 04:06:20.273734912                           NaT      3.0</span>
<span class="go">66        17264      M    85.988469  67.321863      Arts    57.481265    Sci&amp;Tech             True                 0           80.660507  Mkt&amp;Fin  53.962980           NaN   False 2020-03-01 21:10:21.549916416                           NaT      3.0</span>
<span class="go">124       17264      M    63.002392  72.635364  Commerce    67.749160   Comm&amp;Mgmt            False                 1           51.610830  Mkt&amp;Fin  53.308760  31407.586918    True 2020-05-31 11:53:46.568490240                           NaT      3.0</span>
<span class="go">140       17264      M    61.750962  59.217313   Science    73.173480      Others            False                 1           86.727569   Mkt&amp;HR  68.244880           NaN    True 2020-03-11 02:27:45.566609152 2020-05-30 01:38:03.492845568      NaN</span>
<span class="go">150       17264      F    74.927077  69.991721   Science    73.437682   Comm&amp;Mgmt            False                 0           65.214235  Mkt&amp;Fin  66.879456  23518.710763    True                           NaT                           NaT     12.0</span>
<span class="go">162       17264      F    48.348786  68.160478   Science    49.263860    Sci&amp;Tech             True                 0           85.083733  Mkt&amp;Fin  49.472597           NaN    True                           NaT                           NaT     12.0</span>
<span class="go">170       17264      M    54.169281  55.187573  Commerce    57.725293   Comm&amp;Mgmt            False                 0           59.592740   Mkt&amp;HR  59.046062  58036.779552   False 2020-04-29 00:30:37.351016448                           NaT      6.0</span>
</pre></div>
</div>
<p>This happens because the model was not notified at any point about the
fact that the <code class="docutils literal notranslate"><span class="pre">student_id</span></code> had to be unique, so when it generates new
data it will provoke collisions sooner or later. In order to solve this,
we can pass the argument <code class="docutils literal notranslate"><span class="pre">primary_key</span></code> to our model when we create it,
indicating the name of the column that is the index of the table.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CopulaGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [16]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [17]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p>As a result, the model will learn that this column must be unique and
generate a unique sequence of values for the column:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[18]: </span><span class="go"></span>
<span class="go">   student_id gender  second_perc   high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec   mba_perc        salary  placed                    start_date                      end_date duration</span>
<span class="go">0           0      F    75.051008   37.620882  Commerce    75.007378    Sci&amp;Tech            False                 0           83.980436  Mkt&amp;Fin  79.593663  16663.913848    True 2020-01-28 10:25:21.914140160 2020-08-08 06:46:01.245056512      3.0</span>
<span class="go">1           1      M    86.280367   54.783836   Science    53.503507      Others            False                 0           65.858669   Mkt&amp;HR  57.315070  31469.606027   False 2020-02-17 06:07:26.433655552 2020-02-25 20:39:31.453720576      NaN</span>
<span class="go">2           2      F    76.376132   65.055906  Commerce    58.940717   Comm&amp;Mgmt            False                 0           57.035069  Mkt&amp;Fin  75.889642  31896.062309    True                           NaT 2020-08-17 12:59:40.551716352      NaN</span>
<span class="go">3           3      M    83.277419   65.061178  Commerce    83.694644      Others            False                 0           55.931233  Mkt&amp;Fin  61.486373  29174.009179    True 2020-04-04 14:38:47.566167296 2020-06-02 17:24:21.298971904      3.0</span>
<span class="go">4           4      M    72.360620  105.113578  Commerce    65.027355   Comm&amp;Mgmt            False                 0           79.064192   Mkt&amp;HR  53.503364  30163.755528    True                           NaT 2020-06-09 15:23:54.426626560      NaN</span>

<span class="gp">In [19]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">student_id</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gh">Out[19]: </span><span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="anonymizing-personally-identifiable-information-pii">
<h3>Anonymizing Personally Identifiable Information (PII)<a class="headerlink" href="#anonymizing-personally-identifiable-information-pii" title="Permalink to this headline">¶</a></h3>
<p>There will be many cases where the data will contain Personally
Identifiable Information which we cannot disclose. In these cases, we
will want our Tabular Models to replace the information within these
fields with fake, simulated data that looks similar to the real one but
does not contain any of the original values.</p>
<p>Let’s load a new dataset that contains a PII field, the
<code class="docutils literal notranslate"><span class="pre">student_placements_pii</span></code> demo, and try to generate synthetic versions
of it that do not contain any of the PII fields.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">student_placements_pii</span></code> dataset is a modified version of the
<code class="docutils literal notranslate"><span class="pre">student_placements</span></code> dataset with one new field, <code class="docutils literal notranslate"><span class="pre">address</span></code>, which
contains PII information about the students. Notice that this additional
<code class="docutils literal notranslate"><span class="pre">address</span></code> field has been simulated and does not correspond to data
from the real users.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [20]: </span><span class="n">data_pii</span> <span class="o">=</span> <span class="n">load_tabular_demo</span><span class="p">(</span><span class="s1">&#39;student_placements_pii&#39;</span><span class="p">)</span>

<span class="gp">In [21]: </span><span class="n">data_pii</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="gh">Out[21]: </span><span class="go"></span>
<span class="go">                                                              0                                                1                                            2                                 3                                                  4</span>
<span class="go">student_id                                                17264                                            17265                                        17266                             17267                                              17268</span>
<span class="go">address             70304 Baker Turnpike\nEricborough, MS 15086  805 Herrera Avenue Apt. 134\nMaryview, NJ 36510  3702 Bradley Island\nNorth Victor, FL 12268  Unit 0879 Box 3878\nDPO AP 42663  96493 Kelly Canyon Apt. 145\nEast Steven, NC 3...</span>
<span class="go">gender                                                        M                                                M                                            M                                 M                                                  M</span>
<span class="go">second_perc                                                  67                                            79.33                                           65                                56                                               85.8</span>
<span class="go">high_perc                                                    91                                            78.33                                           68                                52                                               73.6</span>
<span class="go">high_spec                                              Commerce                                          Science                                         Arts                           Science                                           Commerce</span>
<span class="go">degree_perc                                                  58                                            77.48                                           64                                52                                               73.3</span>
<span class="go">degree_type                                            Sci&amp;Tech                                         Sci&amp;Tech                                    Comm&amp;Mgmt                          Sci&amp;Tech                                          Comm&amp;Mgmt</span>
<span class="go">work_experience                                           False                                             True                                        False                             False                                              False</span>
<span class="go">experience_years                                              0                                                1                                            0                                 0                                                  0</span>
<span class="go">employability_perc                                           55                                             86.5                                           75                                66                                               96.8</span>
<span class="go">mba_spec                                                 Mkt&amp;HR                                          Mkt&amp;Fin                                      Mkt&amp;Fin                            Mkt&amp;HR                                            Mkt&amp;Fin</span>
<span class="go">mba_perc                                                   58.8                                            66.28                                         57.8                             59.43                                               55.5</span>
<span class="go">salary                                                    27000                                            20000                                        25000                               NaN                                              42500</span>
<span class="go">placed                                                     True                                             True                                         True                             False                                               True</span>
<span class="go">start_date                                  2020-07-23 00:00:00                              2020-01-11 00:00:00                          2020-01-26 00:00:00                               NaT                                2020-07-04 00:00:00</span>
<span class="go">end_date                                    2020-10-12 00:00:00                              2020-04-09 00:00:00                          2020-07-13 00:00:00                               NaT                                2020-09-27 00:00:00</span>
<span class="go">duration                                                    3.0                                              3.0                                          6.0                               NaN                                                3.0</span>
</pre></div>
</div>
<p>If we use our tabular model on this new data we will see how the
synthetic data that it generates discloses the addresses from the real
students:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CopulaGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [23]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_pii</span><span class="p">)</span>

<span class="gp">In [24]: </span><span class="n">new_data_pii</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

<span class="gp">In [25]: </span><span class="n">new_data_pii</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[25]: </span><span class="go"></span>
<span class="go">   student_id                                            address gender  second_perc   high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec   mba_perc        salary  placed                    start_date                      end_date duration</span>
<span class="go">0           0         0478 Sanders Turnpike\nEricafurt, KY 50273      F    88.172111   71.675714  Commerce    45.857582    Sci&amp;Tech            False                 1           72.702943   Mkt&amp;HR  58.645465           NaN   False 2020-03-17 01:57:31.057086208                           NaT     12.0</span>
<span class="go">1           1       29282 Kelley Orchard\nMartinezview, CT 78137      F    68.420564  117.822858   Science    73.536816    Sci&amp;Tech            False                 3           74.916620   Mkt&amp;HR  62.699275  23387.620989    True 2020-07-14 12:14:59.179837696 2020-07-19 20:51:25.989335808      NaN</span>
<span class="go">2           2  13930 Todd Meadow Suite 105\nThompsonton, AZ 6...      F    89.400000   83.576691   Science    50.722164   Comm&amp;Mgmt            False                 1           79.880343  Mkt&amp;Fin  61.695890  26755.288161   False                           NaT 2020-07-12 12:06:19.199018752      6.0</span>
<span class="go">3           3                6021 Linda Lake\nNew Ryan, FL 11149      M    67.669052   55.495710   Science    59.545321    Sci&amp;Tech            False                 1           96.157188  Mkt&amp;Fin  74.175498  26410.821937    True 2020-01-16 02:45:24.653403136 2020-06-11 18:49:25.989382912      NaN</span>
<span class="go">4           4   185 Jasmine Ferry Apt. 294\nPort Nancy, NY 68773      M    89.094680   95.437508  Commerce    64.155430      Others            False                 0           86.574745  Mkt&amp;Fin  70.109439  19389.552986    True 2020-01-26 15:36:16.185667584 2020-08-08 01:45:33.352171008      NaN</span>

<span class="gp">In [26]: </span><span class="n">new_data_pii</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data_pii</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[26]: </span><span class="go">200</span>
</pre></div>
</div>
<p>In order to solve this, we can pass an additional argument
<code class="docutils literal notranslate"><span class="pre">anonymize_fields</span></code> to our model when we create the instance. This
<code class="docutils literal notranslate"><span class="pre">anonymize_fields</span></code> argument will need to be a dictionary that
contains:</p>
<ul class="simple">
<li><p>The name of the field that we want to anonymize.</p></li>
<li><p>The category of the field that we want to use when we generate fake
values for it.</p></li>
</ul>
<p>The list complete list of possible categories can be seen in the <a class="reference external" href="https://faker.readthedocs.io/en/master/providers.html">Faker
Providers</a>
page, and it contains a huge list of concepts such as:</p>
<ul class="simple">
<li><p>name</p></li>
<li><p>address</p></li>
<li><p>country</p></li>
<li><p>city</p></li>
<li><p>ssn</p></li>
<li><p>credit_card_number</p></li>
<li><p>credit_card_expire</p></li>
<li><p>credit_card_security_code</p></li>
<li><p>email</p></li>
<li><p>telephone</p></li>
<li><p>…</p></li>
</ul>
<p>In this case, since the field is an e-mail address, we will pass a
dictionary indicating the category <code class="docutils literal notranslate"><span class="pre">address</span></code></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CopulaGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">anonymize_fields</span><span class="o">=</span><span class="p">{</span>
<span class="gp">   ....: </span>        <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;address&#39;</span>
<span class="gp">   ....: </span>    <span class="p">}</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [28]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_pii</span><span class="p">)</span>
</pre></div>
</div>
<p>As a result, we can see how the real <code class="docutils literal notranslate"><span class="pre">address</span></code> values have been
replaced by other fake addresses that were not taken from the real data
that we learned.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">new_data_pii</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

<span class="gp">In [30]: </span><span class="n">new_data_pii</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[30]: </span><span class="go"></span>
<span class="go">   student_id                                            address gender  second_perc  high_perc high_spec  degree_perc degree_type  work_experience  experience_years  employability_perc mba_spec   mba_perc        salary  placed                    start_date                      end_date duration</span>
<span class="go">0           0           6474 Brenda Knoll\nMillerville, WV 81172      M    44.829961  60.832769   Science    79.900274   Comm&amp;Mgmt            False                 1           73.703253   Mkt&amp;HR  67.593693  44697.138536    True                           NaT 2021-02-25 19:38:51.882067456      NaN</span>
<span class="go">1           1   576 Anderson Wall\nNew Jonathanborough, KS 13614      M    79.622747  41.025366   Science    65.997363    Sci&amp;Tech            False                 0           86.565459   Mkt&amp;HR  64.939674  31460.323882    True 2020-01-10 20:36:42.601048064 2020-06-12 10:13:04.018760192      3.0</span>
<span class="go">2           2          54296 Carroll Dam\nSouth Steven, DE 62134      M    60.642785  81.970961   Science    84.258095   Comm&amp;Mgmt            False                 3           84.931792  Mkt&amp;Fin  62.671013  28598.252296    True 2020-02-24 14:44:54.575185408                           NaT     12.0</span>
<span class="go">3           3  895 Leonard Expressway Suite 334\nPort Shannon...      F    69.320908  28.663766  Commerce    78.483955   Comm&amp;Mgmt            False                 1           80.329259   Mkt&amp;HR  64.139280           NaN    True 2020-01-10 02:50:24.488619264 2021-01-30 13:53:36.186403840      3.0</span>
<span class="go">4           4  4970 Ashley Shores Apt. 068\nLake Johnchester,...      M    69.546595  62.523452   Science    64.028962   Comm&amp;Mgmt            False                 3           54.574335   Mkt&amp;HR  59.565017  31599.999776    True 2020-01-19 10:50:36.806598656 2020-08-29 17:56:51.465960448      NaN</span>

<span class="gp">In [31]: </span><span class="n">new_data_pii</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data_pii</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[31]: </span><span class="go">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h2>
<p>Now that we have discovered the basics, let’s go over a few more
advanced usage examples and see the different arguments that we can pass
to our <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> Model in order to customize it to our needs.</p>
<div class="section" id="exploring-the-probability-distributions">
<h3>Exploring the Probability Distributions<a class="headerlink" href="#exploring-the-probability-distributions" title="Permalink to this headline">¶</a></h3>
<p>During the previous steps, every time we fitted the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code>
it performed the following operations:</p>
<ol class="arabic simple">
<li><p>Learn the format and data types of the passed data</p></li>
<li><p>Transform the non-numerical and null data using <a class="reference external" href="https://github.com/sdv-dev/RDT">Reversible Data
Transforms</a> to obtain a fully
numerical representation of the data from which we can learn the
probability distributions.</p></li>
<li><p>Learn the probability distribution of each column from the table</p></li>
<li><p>Transform the values of each numerical column by converting them
to their marginal distribution CDF values and then applying an
inverse CDF transformation of a standard normal on them.</p></li>
<li><p>Fit a CTGAN model on the transformed data, which learns how each
column is correlated to the others.</p></li>
</ol>
<p>After this, when we used the model to generate new data for our table
using the <code class="docutils literal notranslate"><span class="pre">sample</span></code> method, it did:</p>
<ol class="arabic simple" start="5">
<li><p>Sample rows from the CTGAN model.</p></li>
<li><p>Revert the sampled values by computing their standard normal CDF
and then applyting the inverse CDF of their marginal distributions.</p></li>
<li><p>Revert the RDT transformations to go back to the original data
format.</p></li>
</ol>
<p>As you can see, during these steps the <em>Marginal Probability
Distributions</em> have a very important role, since the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code>
had to learn and reproduce the individual distributions of each column
in our table. We can explore the distributions which the
<code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> used to model each column using its
<code class="docutils literal notranslate"><span class="pre">get_distributions</span></code> method:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [32]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CopulaGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [33]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [34]: </span><span class="n">distributions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_distributions</span><span class="p">()</span>
</pre></div>
</div>
<p>This will return us a <code class="docutils literal notranslate"><span class="pre">dict</span></code> which contains the name of the
distribution class used for each column:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [35]: </span><span class="n">distributions</span>
<span class="gh">Out[35]: </span><span class="go"></span>
<span class="go">{&#39;second_perc&#39;: &#39;copulas.univariate.truncated_gaussian.TruncatedGaussian&#39;,</span>
<span class="go"> &#39;high_perc&#39;: &#39;copulas.univariate.log_laplace.LogLaplace&#39;,</span>
<span class="go"> &#39;degree_perc&#39;: &#39;copulas.univariate.student_t.StudentTUnivariate&#39;,</span>
<span class="go"> &#39;work_experience&#39;: &#39;copulas.univariate.student_t.StudentTUnivariate&#39;,</span>
<span class="go"> &#39;experience_years&#39;: &#39;copulas.univariate.gaussian.GaussianUnivariate&#39;,</span>
<span class="go"> &#39;employability_perc&#39;: &#39;copulas.univariate.truncated_gaussian.TruncatedGaussian&#39;,</span>
<span class="go"> &#39;mba_perc&#39;: &#39;copulas.univariate.gamma.GammaUnivariate&#39;,</span>
<span class="go"> &#39;salary#0&#39;: &#39;copulas.univariate.gamma.GammaUnivariate&#39;,</span>
<span class="go"> &#39;salary#1&#39;: &#39;copulas.univariate.gaussian.GaussianUnivariate&#39;,</span>
<span class="go"> &#39;placed&#39;: &#39;copulas.univariate.gamma.GammaUnivariate&#39;,</span>
<span class="go"> &#39;start_date#0&#39;: &#39;copulas.univariate.gamma.GammaUnivariate&#39;,</span>
<span class="go"> &#39;start_date#1&#39;: &#39;copulas.univariate.gaussian.GaussianUnivariate&#39;,</span>
<span class="go"> &#39;end_date#0&#39;: &#39;copulas.univariate.gamma.GammaUnivariate&#39;,</span>
<span class="go"> &#39;end_date#1&#39;: &#39;copulas.univariate.gaussian.GaussianUnivariate&#39;}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this list we will see multiple distributions for each one of the
columns that we have in our data. This is because the RDT
transformations used to encode the data numerically often use more than
one column to represent each one of the input variables.</p>
</div>
<p>Let’s explore the individual distribution of one of the columns in our
data to better understand how the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> processed them and
see if we can improve the results by manually specifying a different
distribution. For example, let’s explore the <code class="docutils literal notranslate"><span class="pre">experience_years</span></code> column
by looking at the frequency of its values within the original data:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [36]: </span><span class="n">data</span><span class="o">.</span><span class="n">experience_years</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[36]: </span><span class="go"></span>
<span class="go">0    141</span>
<span class="go">1     65</span>
<span class="go">2      8</span>
<span class="go">3      1</span>
<span class="go">Name: experience_years, dtype: int64</span>

<span class="gp">In [37]: </span><span class="n">data</span><span class="o">.</span><span class="n">experience_years</span><span class="o">.</span><span class="n">hist</span><span class="p">();</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/copulagan_experience_years_1.png"><img alt="../../_images/copulagan_experience_years_1.png" src="../../_images/copulagan_experience_years_1.png" style="width: 4in;" /></a>
<p>By observing the data we can see that the behavior of the values in this
column is very similar to a Gamma or even some types of Beta
distribution, where the majority of the values are 0 and the frequency
decreases as the values increase.</p>
<p>Was the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> able to capture this distribution on its own?</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [38]: </span><span class="n">distributions</span><span class="p">[</span><span class="s1">&#39;experience_years&#39;</span><span class="p">]</span>
<span class="gh">Out[38]: </span><span class="go">&#39;copulas.univariate.gaussian.GaussianUnivariate&#39;</span>
</pre></div>
</div>
<p>It seems that the it was not, as it rather thought that the behavior was
closer to a Gaussian distribution. And, as a result, we can see how the
generated values now contain negative values which are invalid for this
column:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [39]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">experience_years</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[39]: </span><span class="go"></span>
<span class="go">0    129</span>
<span class="go">1     69</span>
<span class="go">2      2</span>
<span class="go">Name: experience_years, dtype: int64</span>

<span class="gp">In [40]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">experience_years</span><span class="o">.</span><span class="n">hist</span><span class="p">();</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/copulagan_experience_years_2.png"><img alt="../../_images/copulagan_experience_years_2.png" src="../../_images/copulagan_experience_years_2.png" style="width: 4in;" /></a>
<p>Let’s see how we can improve this situation by passing the
<code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> the exact distribution that we want it to use for
this column.</p>
</div>
<div class="section" id="setting-distributions-for-indvidual-variables">
<h3>Setting distributions for indvidual variables<a class="headerlink" href="#setting-distributions-for-indvidual-variables" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> class offers the possibility to indicate which
distribution to use for each one of the columns in the table, in order
to solve situations like the one that we just described. In order to do
this, we need to pass a <code class="docutils literal notranslate"><span class="pre">field_distributions</span></code> argument with <code class="docutils literal notranslate"><span class="pre">dict</span></code> that
indicates, the distribution that we want to use for each column.</p>
<p>Possible values for the distribution argument are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">univariate</span></code>: Let <code class="docutils literal notranslate"><span class="pre">copulas</span></code> select the optimal univariate
distribution. This may result in non-parametric models being used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parametric</span></code>: Let <code class="docutils literal notranslate"><span class="pre">copulas</span></code> select the optimal univariate
distribution, but restrict the selection to parametric distributions
only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bounded</span></code>: Let <code class="docutils literal notranslate"><span class="pre">copulas</span></code> select the optimal univariate
distribution, but restrict the selection to bounded distributions
only. This may result in non-parametric models being used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">semi_bounded</span></code>: Let <code class="docutils literal notranslate"><span class="pre">copulas</span></code> select the optimal univariate
distribution, but restrict the selection to semi-bounded
distributions only. This may result in non-parametric models being
used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parametric_bounded</span></code>: Let <code class="docutils literal notranslate"><span class="pre">copulas</span></code> select the optimal univariate
distribution, but restrict the selection to parametric and bounded
distributions only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parametric_semi_bounded</span></code>: Let <code class="docutils literal notranslate"><span class="pre">copulas</span></code> select the optimal
univariate distribution, but restrict the selection to parametric and
semi-bounded distributions only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gaussian</span></code>: Use a Gaussian distribution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gamma</span></code>: Use a Gamma distribution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">beta</span></code>: Use a Beta distribution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">student_t</span></code>: Use a Student T distribution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gussian_kde</span></code>: Use a GaussianKDE distribution. This model is
non-parametric, so using this will make <code class="docutils literal notranslate"><span class="pre">get_parameters</span></code> unusable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">truncated_gaussian</span></code>: Use a Truncated Gaussian distribution.</p></li>
</ul>
<p>Let’s see what happens if we make the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> use the
<code class="docutils literal notranslate"><span class="pre">gamma</span></code> distribution for our column.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [41]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CopulaGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">field_distributions</span><span class="o">=</span><span class="p">{</span>
<span class="gp">   ....: </span>        <span class="s1">&#39;experience_years&#39;</span><span class="p">:</span> <span class="s1">&#39;gamma&#39;</span>
<span class="gp">   ....: </span>    <span class="p">}</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [42]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>After this, we can see how the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> used the indicated
distribution for the <code class="docutils literal notranslate"><span class="pre">experience_years</span></code> column</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [43]: </span><span class="n">model</span><span class="o">.</span><span class="n">get_distributions</span><span class="p">()[</span><span class="s1">&#39;experience_years&#39;</span><span class="p">]</span>
<span class="gh">Out[43]: </span><span class="go">&#39;copulas.univariate.gamma.GammaUnivariate&#39;</span>
</pre></div>
</div>
<p>And, as a result, now we can see how the generated data now have a
behavior which is closer to the original data and always stays within
the valid values range.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [44]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="gp">In [45]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">experience_years</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[45]: </span><span class="go"></span>
<span class="go">0    192</span>
<span class="go">1     18</span>
<span class="go">2      3</span>
<span class="go">4      1</span>
<span class="go">3      1</span>
<span class="go">Name: experience_years, dtype: int64</span>

<span class="gp">In [46]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">experience_years</span><span class="o">.</span><span class="n">hist</span><span class="p">();</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/copulagan_experience_years_3.png"><img alt="../../_images/copulagan_experience_years_3.png" src="../../_images/copulagan_experience_years_3.png" style="width: 4in;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even though there are situations like the one show above where manually
choosing a distribution seems to give better results, in most cases the
<code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> will be able to find the optimal distribution on its
own, making this manual search of the marginal distributions necessary
on very little occasions.</p>
</div>
</div>
<div class="section" id="how-to-modify-the-copulagan-hyperparameters">
<h3>How to modify the CopulaGAN Hyperparameters?<a class="headerlink" href="#how-to-modify-the-copulagan-hyperparameters" title="Permalink to this headline">¶</a></h3>
<p>A part from the arguments explained above, <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> has a number
of additional hyperparameters that control its learning behavior and can
impact on the performance of the model, both in terms of quality of the
generated data and computational time:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">epochs</span></code> and <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>: these arguments control the number of
iterations that the model will perform to optimize its parameters, as well as the number
of samples used in each step. Its default values are <code class="docutils literal notranslate"><span class="pre">300</span></code> and <code class="docutils literal notranslate"><span class="pre">500</span></code>
respectively, and <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> needs to always be a value which is
multiple of <code class="docutils literal notranslate"><span class="pre">10</span></code>.</p>
<p>These hyperparameters have a very direct effect in time the training
process lasts but also on the performance of the data, so for new
datasets, you might want to start by setting a low value on both of them
to see how long the training process takes on your data and later on
increase the number to acceptable values in order to improve the
performance.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_frequency</span></code>: Whether to use log frequency of categorical levels in conditional
sampling. It defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>This argument affects how the model processes the frequencies of the
categorical values that are used to condition the rest of the values. In
some cases, changing it to <code class="docutils literal notranslate"><span class="pre">False</span></code> could lead to better performance.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">embedding_dim</span></code> (int): Size of the random sample passed to the
Generator. Defaults to 128.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gen_dim</span></code> (tuple or list of ints): Size of the output samples for each
one of the Residuals. A Resiudal Layer will be created for each one
of the values provided. Defaults to (256, 256).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dis_dim</span></code> (tuple or list of ints): Size of the output samples for each
one of the Discriminator Layers. A Linear Layer will be created for
each one of the values provided. Defaults to (256, 256).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2scale</span></code>: Weight Decay of the Adam Optimizer used to optimize the Neural Networks.
Defaults to <code class="docutils literal notranslate"><span class="pre">1e-6</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code>: Whether to print fit progress on stdout. Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Notice that the value that you set on the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> argument must always be a
multiple of <code class="docutils literal notranslate"><span class="pre">10</span></code>!</p>
</div>
<p>As an example, we will try to fit the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> model slightly
increasing the number of epochs, reducing the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, adding one
additional layer to the models involved and using a smaller wright
decay.</p>
<p>Before we start, we will evaluate the quality of the previously
generated data using the <code class="docutils literal notranslate"><span class="pre">sdv.evaluation.evaluate</span></code> function</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [47]: </span><span class="kn">from</span> <span class="nn">sdv.evaluation</span> <span class="kn">import</span> <span class="n">evaluate</span>

<span class="gp">In [48]: </span><span class="n">evaluate</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gh">Out[48]: </span><span class="go">0.72672008540122</span>
</pre></div>
</div>
<p>Afterwards, we create a new instance of the <code class="docutils literal notranslate"><span class="pre">CopulaGAN</span></code> model with the
hyperparameter values that we want to use</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [49]: </span><span class="n">model</span> <span class="o">=</span> <span class="n">CopulaGAN</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="n">primary_key</span><span class="o">=</span><span class="s1">&#39;student_id&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">epochs</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">gen_dim</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
<span class="gp">   ....: </span>    <span class="n">dis_dim</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
<span class="gp">   ....: </span>    <span class="n">l2scale</span><span class="o">=</span><span class="mf">1e-07</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>And fit to our data.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [50]: </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we are ready to generate new data and evaluate the results.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [51]: </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="gp">In [52]: </span><span class="n">new_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="gh">Out[52]: </span><span class="go"></span>
<span class="go">                                                0                              1                              2                              3                              4</span>
<span class="go">student_id                                      0                              1                              2                              3                              4</span>
<span class="go">gender                                          M                              F                              F                              M                              M</span>
<span class="go">second_perc                               67.4846                        41.0706                        49.4676                        74.5138                        49.9997</span>
<span class="go">high_perc                                 65.1298                        32.0173                          62.14                        67.4868                        65.1941</span>
<span class="go">high_spec                                Commerce                        Science                       Commerce                        Science                       Commerce</span>
<span class="go">degree_perc                               51.9159                        75.1106                        61.9287                        62.7361                        62.9957</span>
<span class="go">degree_type                                Others                      Comm&amp;Mgmt                      Comm&amp;Mgmt                       Sci&amp;Tech                      Comm&amp;Mgmt</span>
<span class="go">work_experience                             False                          False                          False                          False                          False</span>
<span class="go">experience_years                                0                              0                              0                              1                              1</span>
<span class="go">employability_perc                         85.063                        97.7611                        88.2636                        74.8408                        97.9401</span>
<span class="go">mba_spec                                   Mkt&amp;HR                         Mkt&amp;HR                        Mkt&amp;Fin                        Mkt&amp;Fin                         Mkt&amp;HR</span>
<span class="go">mba_perc                                  59.0777                        55.8753                        64.9366                        64.4062                         57.502</span>
<span class="go">salary                                    34409.8                            NaN                            NaN                        21707.9                        24580.9</span>
<span class="go">placed                                       True                           True                           True                           True                          False</span>
<span class="go">start_date          2020-07-29 14:46:25.103009792  2020-03-18 10:42:44.501975040  2020-02-17 21:17:10.265183488  2020-02-16 10:15:09.437999872                            NaT</span>
<span class="go">end_date            2020-07-16 02:23:49.845494784  2020-08-13 22:27:47.875975680                            NaT  2020-08-03 11:01:37.010563072  2020-08-01 02:22:26.783672832</span>
<span class="go">duration                                     12.0                            NaN                            NaN                            NaN                            3.0</span>

<span class="gp">In [53]: </span><span class="n">evaluate</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gh">Out[53]: </span><span class="go">0.7247294803345046</span>
</pre></div>
</div>
<p>As we can see, in this case these modifications changed the obtained
results slightly, but they did neither introduce dramatic changes in the
performance.</p>
</div>
<div class="section" id="how-do-i-specify-constraints">
<h3>How do I specify constraints?<a class="headerlink" href="#how-do-i-specify-constraints" title="Permalink to this headline">¶</a></h3>
<p>If you look closely at the data you may notice that some properties were
not completely captured by the model. For example, you may have seen
that sometimes the model produces an <code class="docutils literal notranslate"><span class="pre">experience_years</span></code> number greater
than <code class="docutils literal notranslate"><span class="pre">0</span></code> while also indicating that <code class="docutils literal notranslate"><span class="pre">work_experience</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>.
These type of properties are what we call <code class="docutils literal notranslate"><span class="pre">Constraints</span></code> and can also
be handled using <code class="docutils literal notranslate"><span class="pre">SDV</span></code>. For further details about them please visit
the <a class="reference internal" href="constraints.html#single-table-constraints"><span class="std std-ref">Handling Constraints</span></a> guide.</p>
</div>
<div class="section" id="can-i-evaluate-the-synthetic-data">
<h3>Can I evaluate the Synthetic Data?<a class="headerlink" href="#can-i-evaluate-the-synthetic-data" title="Permalink to this headline">¶</a></h3>
<p>A very common question when someone starts using <strong>SDV</strong> to generate
synthetic data is: <em>“How good is the data that I just generated?”</em></p>
<p>In order to answer this question, <strong>SDV</strong> has a collection of metrics
and tools that allow you to compare the <em>real</em> that you provided and the
<em>synthetic</em> data that you generated using <strong>SDV</strong> or any other tool.</p>
<p>You can read more about this in the <a class="reference internal" href="evaluation.html#evaluation"><span class="std std-ref">Evaluating Synthetic Data</span></a> guide.</p>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="ctgan.html" title="previous page">CTGAN Model</a>
    <a class='right-next' id="next-link" href="constraints.html" title="next page">Handling Constraints</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018, MIT Data To AI Lab.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>